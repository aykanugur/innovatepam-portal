generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
  // url and directUrl are configured in prisma.config.ts (Prisma v7)
}

// ─── Enums ───────────────────────────────────────────────────────────────────

enum Role {
  SUBMITTER   // default role on creation; displayed as "Submitter" in UI
  ADMIN       // can review ideas; displayed as "Admin" in UI
  SUPERADMIN  // full platform access; displayed as "Super Admin" in UI
}

enum IdeaStatus {
  SUBMITTED     // initial state on creation
  UNDER_REVIEW  // admin has opened the review
  ACCEPTED      // admin decision: accepted
  REJECTED      // admin decision: rejected
}

enum IdeaVisibility {
  PUBLIC   // visible to all authenticated users
  PRIVATE  // visible only to author and admins
}

enum ReviewDecision {
  ACCEPTED // admin approved the idea
  REJECTED // admin rejected the idea
}

// ─── Models ──────────────────────────────────────────────────────────────────

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  displayName  String
  role         Role     @default(SUBMITTER)
  emailVerified Boolean @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  ideas   Idea[]       @relation("UserIdeas")
  reviews IdeaReview[] @relation("UserReviews")
}

model Idea {
  id             String         @id @default(cuid())
  title          String
  description    String
  category       String
  status         IdeaStatus     @default(SUBMITTED)
  visibility     IdeaVisibility @default(PUBLIC)
  attachmentPath String?

  authorId String
  author   User       @relation("UserIdeas", fields: [authorId], references: [id])

  review IdeaReview? @relation("IdeaReview")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model IdeaReview {
  id       String         @id @default(cuid())
  decision ReviewDecision
  comment  String

  ideaId String @unique
  idea   Idea   @relation("IdeaReview", fields: [ideaId], references: [id])

  reviewerId String
  reviewer   User   @relation("UserReviews", fields: [reviewerId], references: [id])

  createdAt DateTime @default(now())
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@index([email])
}
